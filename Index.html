<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>çµæ•°ç¼˜ Â· ç§äººå·ç åˆ†æ</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <meta name="theme-color" content="#F0C7D0">
  <style>
    body {
      font-family: "Helvetica Neue", sans-serif;
      background: linear-gradient(180deg,#FFF8F6,#F0C7D0);
      color: #4a3f41;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px;
      max-width: 400px;
      margin: 40px auto;
    }
    input {
      width: 90%;
      padding: 8px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    button {
      background-color: #D89CAE;
      color: #fff;
      border: none;
      padding: 10px 20px;
      margin-top: 10px;
      border-radius: 8px;
      font-size: 16px;
    }
    #result {
      text-align: left;
      margin-top: 20px;
      background-color: #fffafc;
      padding: 15px;
      border-radius: 8px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>ğŸŒ· çµæ•°ç¼˜ Â· ç§äººå·ç åˆ†æ</h2>
  <div class="card">
    <input id="name" placeholder="å§“åï¼ˆå¯é€‰ï¼‰"><br>
    <input id="birthday" placeholder="å‡ºç”Ÿæ—¥æœŸ YYYY-MM-DD"><br>
    <input id="number" placeholder="è¦åˆ†æçš„å·ç ï¼ˆåªéœ€æ•°å­—ï¼‰"><br>
    <button onclick="analyze()">å¼€å§‹åˆ†æ</button>
    <button onclick="recommend()">æ¨èæ•°å­—</button>
    <div id="result"></div>
  </div>

  <script>
    const DIGIT_ELEMENTS = {"1":"æ°´","2":"æœ¨","3":"æœ¨","4":"ç«","5":"åœŸ","6":"é‡‘","7":"é‡‘","8":"åœŸ","9":"ç«","0":"æ°´"};
    const GENERATE_MAP = {"æœ¨":"ç«","ç«":"åœŸ","åœŸ":"é‡‘","é‡‘":"æ°´","æ°´":"æœ¨"};
    const CONTROL_MAP  = {"æœ¨":"åœŸ","åœŸ":"æ°´","æ°´":"ç«","ç«":"é‡‘","é‡‘":"æœ¨"};

    function fake_birth_five_elements(birth){
      try{
        const [y,m,d]=birth.split("-").map(Number);
        const total=y+m+d;
        const count={"é‡‘":0,"æœ¨":0,"æ°´":0,"ç«":0,"åœŸ":0};
        for(const ch of String(total)){
          const e=DIGIT_ELEMENTS[ch];
          if(e) count[e]++;
        }
        if(Object.values(count).every(v=>v===0)) count["åœŸ"]=1;
        return count;
      }catch(e){return {"é‡‘":0,"æœ¨":0,"æ°´":0,"ç«":0,"åœŸ":0};}
    }

    function analyze_number(num,birth){
      const count={"é‡‘":0,"æœ¨":0,"æ°´":0,"ç«":0,"åœŸ":0};
      for(const ch of num){const e=DIGIT_ELEMENTS[ch]; if(e) count[e]++;}
      let score=70,notes=[];
      for(const el of Object.keys(count)){
        if(birth[el]===0){
          for(const n_el of Object.keys(count)){
            if(GENERATE_MAP[n_el]===el && count[n_el]>0){
              score+=10;notes.push(`${n_el}ç”Ÿ${el}ï¼Œå¯è¡¥è¶³ç¼ºçš„${el}ã€‚`);
            }
            if(CONTROL_MAP[n_el]===el && count[n_el]>0){
              score-=10;notes.push(`${n_el}å…‹${el}ï¼Œæœ‰å°‘è®¸å†²å…‹ã€‚`);
            }
          }
        }
      }
      if(Object.values(count).filter(v=>v>0).length>=3){score+=5;notes.push("å·ç äº”è¡Œè¾ƒä¸ºå¤šå…ƒï¼Œèƒ½é‡æµåŠ¨é¡ºç•…ã€‚");}
      score=Math.max(30,Math.min(99,score));
      const type=score>=85?"æ—ºè´¢Â·è´µäººå‹":score>=75?"åŠ©è¿Â·ç¨³è´¢å‹":score>=60?"å¹³ç¨³éœ€ç•™æ„":"ä¸å¤ªå¥‘åˆ";
      return {count,score,notes,type};
    }

    function analyze(){
      const name=document.getElementById("name").value;
      const birth=document.getElementById("birthday").value;
      const num=document.getElementById("number").value.replace(/\D/g,"");
      if(!birth){alert("è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ");return;}
      if(!num){alert("è¯·è¾“å…¥å·ç ");return;}
      const birth_el=fake_birth_five_elements(birth);
      const res=analyze_number(num,birth_el);
      const r=document.getElementById("result");
      let txt=`ğŸŒ¿ çµæ•°ç¼˜ Â· åˆ†ææŠ¥å‘Š\n`;
      if(name) txt+=`å§“åï¼š${name}\n`;
      txt+=`ç”Ÿæ—¥ï¼š${birth}\nå·ç ï¼š${num}\n\n`;
      txt+=`å‘½ä¸»äº”è¡Œï¼š${JSON.stringify(birth_el)}\nå·ç äº”è¡Œï¼š${JSON.stringify(res.count)}\n\n`;
      txt+=`åŒ¹é…åˆ†æ•°ï¼š${res.score} åˆ† Â· ç±»å‹ï¼š${res.type}\n\n`;
      if(res.notes.length) txt+=`é¡¾é—®è¯´æ˜ï¼š\n${res.notes.map(n=>"â€¢ "+n).join("\n")}\n`;
      else txt+=`é¡¾é—®è¯´æ˜ï¼šèƒ½é‡å¹³è¡¡è‰¯å¥½ã€‚\n`;
      txt+=`\nâœ¨ å»ºè®®ï¼š${res.score>=85?"éå¸¸å¥‘åˆï¼Œå¯é•¿æœŸä½¿ç”¨ã€‚":res.score>=70?"å¹³è¡¡åº¦ä½³ï¼Œå¯å¼ºåŒ–è¡¥ç¼ºæ•°å­—ã€‚":"éƒ¨åˆ†å†²å…‹ï¼Œå»ºè®®è°ƒæ•´å·ç ã€‚"}\n`;
      r.textContent=txt;
    }

    function recommend(){
      const birth=document.getElementById("birthday").value;
      if(!birth){alert("è¯·å¡«å†™å‡ºç”Ÿæ—¥æœŸ");return;}
      const birth_el=fake_birth_five_elements(birth);
      const map={"é‡‘":["6","7"],"æœ¨":["2","3"],"æ°´":["1","0"],"ç«":["4","9"],"åœŸ":["5","8"]};
      let rec=[];
      for(const el in birth_el) if(birth_el[el]===0) rec=rec.concat(map[el]);
      if(rec.length===0) rec=["2","6","8"];
      document.getElementById("result").textContent=`æ¨èè¡¥ç¼ºæ•°å­—ï¼š${rec.join("ï¼Œ")}`;
    }

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
