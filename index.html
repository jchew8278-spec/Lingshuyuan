<!doctype html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>灵数缘 · 数字能量解读（Web）</title>
<meta name="theme-color" content="#F6EEDB">
<style>
  :root{
    --bg1:#F9F6F2; --bg2:#F2E9DD;
    --card:#ffffff; --accent:#C9A86A; --text:#3b2f2b; --muted:#7a6a63;
    --pill-bg:#FFF7EA;
  }
  html,body{height:100%;margin:0;font-family: Georgia, 'Times New Roman', serif;color:var(--text);}
  body{background: linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased;padding:18px;}
  .wrap{max-width:920px;margin:0 auto;}
  header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
  h1{margin:0;font-size:20px}
  .lead{margin:0;color:var(--muted)}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 8px 28px rgba(70,50,40,0.06)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  input[type='text'], input[type='date']{padding:10px;border-radius:8px;border:1px solid #efe6dd;font-size:15px;width:220px;}
  button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
  .muted{color:var(--muted);font-size:13px}
  .result{margin-top:14px}
  .title{font-weight:700;color:#5b3f2f;font-size:18px}
  .meta{margin-top:8px;color:var(--muted);font-size:14px}
  .pill{display:inline-block;padding:6px 8px;border-radius:20px;background:var(--pill-bg);border:1px solid rgba(200,160,90,0.12);margin-right:8px}
  .grid{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .numbtn{padding:10px 12px;border-radius:10px;border:1px solid rgba(200,160,90,0.15);background:#fff;cursor:pointer}
  footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>灵数缘 · 数字能量解读</h1>
      <p class="lead">金土和谐 · 雅体风 · 输入生日 / 门牌 / 手机号 → 自动计算并显示对应灵数解读</p>
    </div>
  </header>
  <div id="mainCard" class="card">
    <div id="statusBar" class="muted">正在加载数据库…</div>
    <div class="controls">
      <div><label class="muted">生日（YYYY-MM-DD）</label><br><input id="birth" type="date" /></div>
      <div><label class="muted">门牌或号码（只输入数字）</label><br><input id="digits" type="text" placeholder="例如：532 或 98765432" /></div>
      <div style="align-self:end"><button id="calcBtn">计算灵数</button></div>
      <div style="flex:1; text-align:right; align-self:end"><button id="showAll" style="background:#8aa29a">浏览全部</button></div>
    </div>
    <div id="resultArea" class="result card" style="margin-top:12px;">
      <div id="content"><div class="title">欢迎使用灵数缘 · 原型</div><div class="meta">把生日 / 门牌 / 手机号相加后，会映射到 1–81 中的一组数理，显示命理解释与疗愈心语。</div></div>
    </div>
    <div style="margin-top:12px"><div class="muted">快速试览（点数字）</div><div id="quickGrid" class="grid"></div></div>
  </div>
  <footer>灵数缘 · 顾问版 V1.0 · —— Julie潘芊名 · 灵数缘心语</footer>
</div>
<script>
let DATA=null;
function showStatus(msg,isError){const s=document.getElementById('statusBar');s.textContent=msg;s.style.color=isError?'crimson':'var(--muted)';}
function sumDigitsFromString(s){const digits=s.replace(/\D/g,'').split('');let total=0;digits.forEach(ch=>{if(ch)total+=Number(ch);});return total;}
function mapTo81(n){if(!isFinite(n)||n<=0)return 1;return((n-1)%81)+1;}
function renderQuickGrid(){const q=document.getElementById('quickGrid');q.innerHTML='';for(let i=1;i<=81;i++){const btn=document.createElement('div');btn.className='numbtn';btn.textContent=i;btn.onclick=()=>showItem(i);q.appendChild(btn);}}
function showItem(id){if(!DATA){alert('数据库尚未加载。请稍候或检查 JSON 文件是否已上传。');return;}const entry=DATA.entries.find(x=>x.id===id)||null;if(!entry){document.getElementById('content').innerHTML='<div class="title">未找到该编号</div>';return;}const html=[`<div class="title">${entry.title}</div>`,`<div style="margin-top:8px"><span class="pill">五行：${entry.element}</span><span class="pill">吉凶：${entry.fortune}</span></div>`,`<p style="margin-top:12px">${entry.personality}</p>`,`<p style="margin-top:10px"><strong>建议：</strong> ${entry.advice}</p>`,`<p style="margin-top:10px;color:var(--muted)"><em>${entry.heart}</em></p>`].join('');document.getElementById('content').innerHTML=html;window.scrollTo({top:0,behavior:'smooth'});}
function showAllList(){if(!DATA)return alert('数据库尚未加载');const htmlParts=['<div class="title">全部 1–81 列表</div>','<div style="margin-top:10px" class="muted">点编号查看详情</div>','<div style="margin-top:10px">'];DATA.entries.forEach(e=>{htmlParts.push(`<button class="numbtn" style="margin:6px" onclick="showItem(${e.id})">${e.id} · ${e.title.replace(/^[0-9]+号 · /,'')}</button>`);});htmlParts.push('</div>');document.getElementById('content').innerHTML=htmlParts.join('');window.scrollTo({top:0,behavior:'smooth'});}
document.getElementById('calcBtn').addEventListener('click',()=>{const birth=document.getElementById('birth').value;const digits=document.getElementById('digits').value||'';let total=0;if(birth){const raw=birth.replace(/\D/g,'');total+=sumDigitsFromString(raw);}if(digits){total+=sumDigitsFromString(digits);}if(total===0){alert('请输入生日或数字（例如门牌/手机号）');return;}const id=mapTo81(total);showItem(id);});
document.getElementById('showAll').addEventListener('click',showAllList);
async function loadData(){showStatus('正在加载数据库… 请稍候');try{const resp=await fetch('./lingshuyuan_full_2025.json?t='+Date.now());if(!resp.ok)throw new Error('无法取得 JSON (HTTP '+resp.status+')');DATA=await resp.json();if(!DATA||!DATA.entries){if(Array.isArray(DATA)){DATA={entries:DATA,epilogue:null};}}if(!DATA||!DATA.entries)throw new Error('JSON 格式错误，请确认文件为 { entries:[...], epilogue:"..." }');showStatus('数据库已加载 · 可开始输入查询');renderQuickGrid();}catch(err){console.error(err);showStatus('加载数据库失败：'+err.message,true);document.getElementById('content').innerHTML='<div class="title">未能加载数据</div><div class="muted" style="margin-top:8px">请确认文件名为 <strong>lingshuyuan_full_2025.json</strong> 且位于仓库根目录。</div>';renderQuickGrid();}}
loadData();
</script>
</body>
</html>